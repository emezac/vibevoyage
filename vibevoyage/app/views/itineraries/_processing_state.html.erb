<!-- app/views/itineraries/_processing_state.html.erb -->
<section class="py-20 px-4 min-h-screen flex items-center justify-center" id="processing-section">
  <div class="max-w-4xl mx-auto">
    <div class="glass-card glass-strong p-8 text-center relative overflow-hidden">
      <!-- Animated Background -->
      <div class="absolute inset-0 opacity-10">
        <div class="w-full h-full" style="background: linear-gradient(45deg, var(--accent-terracotta), transparent, var(--accent-sage), transparent); animation: gradient-shift 3s ease-in-out infinite;"></div>
      </div>
      
      <div class="relative z-10">
        <div class="flex justify-center items-center mb-8">
          <div class="relative">
            <div class="w-20 h-20 rounded-full flex items-center justify-center thinking-animation status-indicator" style="background: radial-gradient(circle, var(--accent-terracotta), rgba(224, 122, 95, 0.3));">
              <svg class="w-10 h-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z"/>
              </svg>
            </div>
            <div class="absolute -inset-2 rounded-full opacity-30 animate-ping" style="background: radial-gradient(circle, var(--accent-terracotta), transparent);"></div>
          </div>
        </div>
        
        <h3 class="text-3xl md:text-4xl font-display font-bold text-white mb-4">Analizando tu esencia cultural...</h3>
        <p class="text-slate-300 text-lg md:text-xl mb-8">Conectando tus pasiones con experiencias únicas.</p>
        
        <!-- Enhanced Processing Status -->
        <div class="glass-card bg-black/40 p-6 rounded-2xl font-mono text-sm text-left space-y-3 border-0">
          <% if defined?(show_logs) && show_logs %>
            <div class="flex items-center gap-3 text-green-400">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              <%= defined?(message) ? message : "Vibe recibido. Deconstruyendo..." %>
            </div>
          <% else %>
            <div class="flex items-center gap-3 text-green-400">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              Vibe recibido. Deconstruyendo...
            </div>
            <div class="flex items-center gap-3 text-yellow-400">
              <div class="w-4 h-4 border-2 border-yellow-400 border-t-transparent rounded-full animate-spin"></div>
              Consultando el oráculo cultural...
            </div>
            <div class="flex items-center gap-3 text-cyan-400 opacity-50">
              <div class="w-4 h-4 border-2 border-cyan-400 border-t-transparent rounded-full"></div>
              Mapeando afinidades culturales
            </div>
            <div class="flex items-center gap-3 text-orange-400 opacity-50">
              <div class="w-4 h-4 border-2 border-orange-400 border-t-transparent rounded-full"></div>
              Generando narrativa personalizada...
            </div>
          <% end %>
        </div>
        
        <!-- Progress Bar -->
        <div class="mt-8">
          <div class="flex justify-between text-sm text-slate-400 mb-2">
            <span>Progreso del Análisis Cultural</span>
            <span><%= defined?(progress) ? "#{progress}%" : "25%" %></span>
          </div>
          <div class="w-full bg-white/10 rounded-full h-2">
            <div class="vibe-match-bar" style="width: <%= defined?(progress) ? "#{progress}%" : "25%" %>;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
@keyframes gradient-shift {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

.thinking-animation {
  animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 0.6; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.05); }
}

.vibe-match-bar {
  background: linear-gradient(90deg, var(--accent-terracotta), var(--accent-gold));
  border-radius: 9999px;
  height: 4px;
  position: relative;
  overflow: hidden;
  transition: width 0.5s ease-out;
}

.vibe-match-bar::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
  animation: shine 2s ease-in-out infinite;
}

@keyframes shine {
  0% { left: -100%; }
  50% { left: 100%; }
  100% { left: 100%; }
}
</style>